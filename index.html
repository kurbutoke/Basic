<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ff4600">
    <title>Basic Fit QR Generator</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>

<body>
    <button class="theme-toggle" onclick="toggleTheme()" id="themeBtn">üåô</button>

    <div class="card">
        <h1>Basic Fit QR Generator</h1>

        <div id="loginForm">
            <button class="help-trigger" onclick="toggleModal(true)">O√π trouver mes infos ?</button>

            <div class="profile-manager">
                <select id="profileSelect" class="profile-select" onchange="loadProfile()">
                    <option value="">Nouveau profil</option>
                </select>
                <button class="btn-icon" id="favBtn" onclick="toggleFavorite()"
                    title="Favori (D√©marrage auto)">‚òÜ</button>
                <button class="btn-icon" onclick="saveProfile()" title="Sauvegarder">üíæ</button>
                <button class="btn-icon" onclick="deleteProfile()" title="Supprimer">üóëÔ∏è</button>
            </div>

            <div class="form-group">
                <label for="cardNumber">Num√©ro de Carte</label>
                <div class="input-wrapper">
                    <input type="text" id="cardNumber" placeholder="Ex: V012345678" oninput="validateCard()">
                    <button class="input-toggle" onclick="toggleInput('cardNumber', this)">üëÅÔ∏è</button>
                </div>
                <div id="cardError" class="validation-msg">Format invalide (Ex: V123456789)</div>
            </div>

            <div class="form-group">
                <label for="deviceId">Device ID</label>
                <div class="input-wrapper">
                    <input type="password" id="deviceId" placeholder="Ex: 8d20fc96-..." oninput="validateDevice()">
                    <button class="input-toggle" onclick="toggleInput('deviceId', this)">üëÅÔ∏è</button>
                </div>
                <div id="deviceError" class="validation-msg">Format UUID invalide</div>
            </div>

            <button onclick="handleLogin()">G√©n√©rer QR Code</button>
        </div>

        <div id="qrDisplay" class="hidden">
            <div id="qrcode" onclick="toggleFullscreen()"></div>
            <button class="exit-fullscreen" onclick="toggleFullscreen()">Fermer le plein √©cran</button>

            <div class="progress-bar">
                <div class="progress-fill" id="progress"></div>
            </div>

            <div class="info">
                QR Code g√©n√©r√© localement.<br>
                Se rafra√Æchit toutes les 5s.
                <br>
                <a href="#" onclick="toggleFullscreen(); return false;"
                    style="color: var(--primary-color); font-size: 0.8rem;">[üîç Mode Plein √âcran]</a>
            </div>

            <div style="margin-top: 20px;">
                <button class="secondary" onclick="shareUrl()">Partager l'URL</button>
                <button class="secondary" onclick="logout()"
                    style="border: none; color: #999; font-size: 0.8rem; margin-top: 5px;">Modifier /
                    D√©connexion</button>
            </div>
        </div>
    </div>

    <div class="footer">
        Merci √† <a href="https://blog.szeroki.fr/posts/les-qr-codes-de-basic-fit-comment-ca-fonctionne"
            target="_blank">Szeroki</a> pour la documentation.
    </div>

    <div id="helpModal" class="modal-overlay" onclick="handleOverlayClick(event)">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Aide</h2>
                <button class="modal-close" onclick="toggleModal(false)">&times;</button>
            </div>
            <div class="modal-content">
                <div class="help-section">
                    <h3>Comment r√©cup√©rer mes infos ?</h3>
                    <p>Pour faire fonctionner le g√©n√©rateur, vous avez besoin de votre <strong>Num√©ro de Carte</strong>
                        et de votre <strong>Device ID</strong>.</p>

                    <h4>√âtape 1 : D√©connexion</h4>
                    <p>Sur l'appareil qui g√©n√®re habituellement les QR codes, d√©connectez-vous de l'application
                        Basic-Fit.</p>

                    <h4>√âtape 2 : Page de connexion</h4>
                    <p>Lancez la page de connexion √† l'aide du bouton "Connexion".</p>

                    <h4>√âtape 3 : Copier l'URL de la popup</h4>
                    <p>Copiez l'URL de la popup de la page de connexion en appuyant longuement sur l'URL puis "Copier".
                    </p>
                    <img class="image-placeholder" src="./sc/login.gif">

                    <h4>√âtape 4 : R√©cup√©rer les infos</h4>
                    <p>Par la suite rendez-vous sur n'importe quel application (Notes/Messages/...) pour coller l'URL,
                        et trouvez les param√®tres <code>deviceID</code> (Device ID) et <code>card-Number</code> (Num√©ro
                        de Carte).</p>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast">URL copi√©e !</div>

    <script src="script.js"></script>
</body>

</html>